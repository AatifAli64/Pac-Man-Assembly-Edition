include irvine32.inc
include macros.inc
includelib Winmm.lib
              

PlaySound PROTO,
        pszSound:PTR BYTE, 
        hmod:DWORD, 
        fdwSound:DWORD

; ;  55 x1 31 = 1705   | 1723   | 482
; all the procedures
screenone proto
screentwo proto
updatePointer proto
actualgamescreen proto
MyDelay proto
GhostEatCheck proto :BYTE, :BYTE, :BYTE, :BYTE, :BYTE, :BYTE, :BYTE, :BYTE



.data

up1 db 0
down1 db 0
left1 db 0
right1 db 0
up2 db 0
down2 db 0
left2 db 0
right2 db 0

targetX db 0
targetY db 0

distanceUp DW 999           ; Distance for moving up1
distanceDown DW 999         ; Distance for moving down1
distanceLeft DW 999       ; Distance for moving left1
distanceRight DW 999       ; Distance for moving right1
check4 db 0              ; Checker for the direction
check3 db 0              ; Checker for the direction
check9 db 0              ; Checker for the direction
check6 db 0              ; Checker for the direction
x4previous db 0
y4previous db 0
y3previous db 0
x3previous db 0
y6previous db 0
x6previous db 0
y9previous db 0
x9previous db 0
pXprevious db 0
pYprevious db 0

oneMinuteStart   DWORD 0        ; Start time for one-minute timer in ms
scaredStartTime  DWORD 0        ; Start time for scared ghost timer in ms
timerInitialized BYTE 0         ; Flag to check4 if timer is initialized
scaredGhostActive BYTE 0        ; Flag to indicate scared ghost state
currentTime      DWORD 0        ; Variable to hold current time in ms

MaxX db 31
MaxY db 57
MinX db 0
MinY db 1

    screen1 db " ______________________________________________________________________________________________________________________ ", 13, 10 
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                            _______    ______    ______   __       __   ______   __    __                             |", 13, 10
            db "|                           |       \  /      \  /      \ |  \     /  \ /      \ |  \  |  \                            |", 13, 10
            db "|                           | $$$$$$$\|  $$$$$$\|  $$$$$$\| $$\   /  $$|  $$$$$$\| $$\ | $$                            |", 13, 10
            db "|                           | $$__/ $$| $$__| $$| $$   \$$| $$$\ /  $$$| $$__| $$| $$$\| $$                            |", 13, 10
            db "|                           | $$    $$| $$    $$| $$      | $$$$\  $$$$| $$    $$| $$$$\ $$                            |", 13, 10
            db "|                           | $$$$$$$ | $$$$$$$$| $$   __ | $$\$$ $$ $$| $$$$$$$$| $$\$$ $$                            |", 13, 10
            db "|                           | $$      | $$  | $$| $$__/  \| $$ \$$$| $$| $$  | $$| $$ \$$$$                            |", 13, 10
            db "|                           | $$      | $$  | $$ \$$    $$| $$  \$ | $$| $$  | $$| $$  \$$$                            |", 13, 10
            db "|                            \$$       \$$   \$$  \$$$$$$  \$$      \$$ \$$   \$$ \$$   \$$                            |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10  
            db "|                                []========================================================[]                          |", 13, 10
            db "|                                || Usernsme:                                              ||                          |", 13, 10  
            db "|                                []========================================================[]                          |", 13, 10
            db "|                                                                                                                      |", 13, 10  
            db "|                                                                                                                      |", 13, 10
            db "|                                                                                                                      |", 13, 10  
            db "|                                                                                                                      |", 13, 10
            db "|______________________________________________________________________________________________________________________|", 13, 10
            db 0

START             db "                               ______  ________   ______   _______  ________   ", 13, 10
                  db "                              /      \|        \ /      \ |       \|        \  ", 13, 10
                  db "                             |  $$$$$$\\$$$$$$$$|  $$$$$$\| $$$$$$$\\$$$$$$$$  ", 13, 10
                  db "                             | $$___\$$  | $$   | $$__| $$| $$__| $$  | $$     ", 13, 10
                  db "                              \$$    \   | $$   | $$    $$| $$    $$  | $$     ", 13, 10
                  db "                              _\$$$$$$\  | $$   | $$$$$$$$| $$$$$$$\  | $$     ", 13, 10
                  db "                             |  \__| $$  | $$   | $$  | $$| $$  | $$  | $$     ", 13, 10
                  db "                              \$$    $$  | $$   | $$  | $$| $$  | $$  | $$     ", 13, 10
                  db "                               \$$$$$$    \$$    \$$   \$$ \$$   \$$   \$$     ", 13, 10
                  db 0   

INSTRUCTIONS    db "         ______  __    __   ______  ________  _______   __    __   ______  ________  ______   ______   __    __   ", 13, 10
                db "        |      \|  \  |  \ /      \|        \|       \ |  \  |  \ /      \|        \|      \ /      \ |  \  |  \  ", 13, 10
                db "         \$$$$$$| $$\ | $$|  $$$$$$\\$$$$$$$$| $$$$$$$\| $$  | $$|  $$$$$$\\$$$$$$$$ \$$$$$$|  $$$$$$\| $$\ | $$  ", 13, 10
                db "          | $$  | $$$\| $$| $$___\$$  | $$   | $$__| $$| $$  | $$| $$   \$$  | $$     | $$  | $$  | $$| $$$\| $$  ", 13, 10
                db "          | $$  | $$$$\ $$ \$$    \   | $$   | $$    $$| $$  | $$| $$        | $$     | $$  | $$  | $$| $$$$\ $$  ", 13, 10
                db "          | $$  | $$\$$ $$ _\$$$$$$\  | $$   | $$$$$$$\| $$  | $$| $$   __   | $$     | $$  | $$  | $$| $$\$$ $$  ", 13, 10
                db "         _| $$_ | $$ \$$$$|  \__| $$  | $$   | $$  | $$| $$__/ $$| $$__/  \  | $$    _| $$_ | $$__/ $$| $$ \$$$$  ", 13, 10
                db "        |   $$ \| $$  \$$$ \$$    $$  | $$   | $$  | $$ \$$    $$ \$$    $$  | $$   |   $$ \ \$$    $$| $$  \$$$  ", 13, 10
                db "         \$$$$$$ \$$   \$$  \$$$$$$    \$$    \$$   \$$  \$$$$$$   \$$$$$$    \$$    \$$$$$$  \$$$$$$  \$$   \$$  ", 13, 10
                db 0
            
EXITED           db "                                 ________  __    __  ______  ________  ", 13, 10
                 db "                                |        \|  \  |  \|      \|        \ ", 13, 10
                 db "                                | $$$$$$$$| $$  | $$ \$$$$$$ \$$$$$$$$ ", 13, 10
                 db "                                | $$__     \$$\/  $$  | $$     | $$    ", 13, 10
                 db "                                | $$  \     >$$  $$   | $$     | $$    ", 13, 10
                 db "                                | $$$$$    /  $$$$\   | $$     | $$    ", 13, 10
                 db "                                | $$_____ |  $$ \$$\ _| $$_    | $$    ", 13, 10
                 db "                                | $$     \| $$  | $$|   $$ \   | $$    ", 13, 10
                 db "                                 \$$$$$$$$ \$$   \$$ \$$$$$$    \$$    ", 13, 10   
                 db 0

POINTER            db"  <<<   ",13,10
                    db 0

INSTRUCTIONS_SCREEN            db"Controls:                                                                                        ",13,10
                               db"                                                                                                 ",13,10
                               db" 1-Use the (w a s d) to move Pac-Man through the maze.                                           ",13,10
                               db" 2-Try to eat all the dots in the maze to advance to the next level.                             ",13,10
                               db"                                                                                                 ",13,10
                               db" Gameplay:                                                                                       ",13,10
                               db"                                                                                                 ",13,10
                               db" 1-Pac-Man moves through the maze, consuming dots along the way.                                 ",13,10
                               db" 2-Avoid contact with the ghosts; they will try to catch Pac-Man.                                ",13,10
                               db" 3-Eating a power pellet turns the ghosts blue, allowing Pac-Man to eat them for a limited time. ",13,10
                               db" #-Eating fruits for extra points may appear at certain times in the maze.                       ",13,10
                               db"                                                                                                 ",13,10
                               db" Scoring:                                                                                        ",13,10
                               db"                                                                                                 ",13,10
                               db" 1-Each dot consumed earns points.                                                               ",13,10
                               db" 2-Eating ghosts after consuming a power pellet earns bonus points.                              ",13,10
                               db" 3-Bonus points are awarded for completing a level.                                              ",13,10
                               db"                                                                                                 ",13,10
                               db" Game Over:                                                                                      ",13,10
                               db"                                                                                                 ",13,10
                               db" 1-If Pac-Man collides with a ghost without consuming a power pellet, a life is lost.            ",13,10
                               db" 2-Losing all lives ends the game. You have three lives to start.                                ",13,10
                               db 0

gameOverScreen1    db "              ______    ______   __       __  ________         ______   __     __  ________  _______     ",13,10
                  db "             /      \  /      \ |  \     /  \|        \       /      \ |  \   |  \|        \|       \    ",13,10
                  db "            |  $$$$$$\|  $$$$$$\| $$\   /  $$| $$$$$$$$      |  $$$$$$\| $$   | $$| $$$$$$$$| $$$$$$$\   ",13,10
                  db "            | $$ __\$$| $$__| $$| $$$\ /  $$$| $$__          | $$  | $$| $$   | $$| $$__    | $$__| $$   ",13,10
                  db "            | $$|    \| $$    $$| $$$$\  $$$$| $$  \         | $$  | $$ \$$\ /  $$| $$  \   | $$    $$   ",13,10
                  db "            | $$ \$$$$| $$$$$$$$| $$\$$ $$ $$| $$$$$         | $$  | $$  \$$\  $$ | $$$$$   | $$$$$$$\   ",13,10
                  db "            | $$__| $$| $$  | $$| $$ \$$$| $$| $$_____       | $$__/ $$   \$$ $$  | $$_____ | $$  | $$   ",13,10
                  db "             \$$    $$| $$  | $$| $$  \$ | $$| $$     \       \$$    $$    \$$$   | $$     \| $$  | $$   ",13,10  
                  db "              \$$$$$$  \$$   \$$ \$$      \$$ \$$$$$$$$        \$$$$$$      \$     \$$$$$$$$ \$$   \$$   ",13,10
                  db 0 

level1    db "                               __        ________  __     __  ________  __                __         ", 13, 10
          db "                              |  \      |        \|  \   |  \|        \|  \             _/  \        ", 13, 10
          db "                              | $$      | $$$$$$$$| $$   | $$| $$$$$$$$| $$            |   $$        ", 13, 10
          db "                              | $$      | $$__    | $$   | $$| $$__    | $$             \$$$$        ", 13, 10
          db "                              | $$      | $$  \    \$$\ /  $$| $$  \   | $$              | $$        ", 13, 10
          db "                              | $$      | $$$$$     \$$\  $$ | $$$$$   | $$              | $$        ", 13, 10
          db "                              | $$_____ | $$_____    \$$ $$  | $$_____ | $$_____        _| $$_       ", 13, 10
          db "                              | $$     \| $$     \    \$$$   | $$     \| $$     \      |   $$ \      ", 13, 10
          db "                               \$$$$$$$$ \$$$$$$$$     \$     \$$$$$$$$ \$$$$$$$$       \$$$$$$      ", 13, 10
          db 0

level2    db "                                                                                                     ", 13, 10
          db "                               __        ________  __     __  ________  __               ______      ", 13, 10
          db "                              |  \      |        \|  \   |  \|        \|  \             /      \     ", 13, 10
          db "                              | $$      | $$$$$$$$| $$   | $$| $$$$$$$$| $$            |  $$$$$$\    ", 13, 10
          db "                              | $$      | $$__    | $$   | $$| $$__    | $$             \$$__| $$    ", 13, 10
          db "                              | $$      | $$  \    \$$\ /  $$| $$  \   | $$             /      $$    ", 13, 10
          db "                              | $$      | $$$$$     \$$\  $$ | $$$$$   | $$            |  $$$$$$     ", 13, 10
          db "                              | $$_____ | $$_____    \$$ $$  | $$_____ | $$_____       | $$_____     ", 13, 10
          db "                              | $$     \| $$     \    \$$$   | $$     \| $$     \      | $$     \    ", 13, 10
          db "                               \$$$$$$$$ \$$$$$$$$     \$     \$$$$$$$$ \$$$$$$$$       \$$$$$$$$    ", 13, 10
          db 0
       
level3    db "                                                                                                     ", 13, 10
          db "                               __        ________  __     __  ________  __               ______      ", 13, 10
          db "                              |  \      |        \|  \   |  \|        \|  \             /      \     ", 13, 10
          db "                              | $$      | $$$$$$$$| $$   | $$| $$$$$$$$| $$            |  $$$$$$\    ", 13, 10
          db "                              | $$      | $$__    | $$   | $$| $$__    | $$             \$$__| $$    ", 13, 10
          db "                              | $$      | $$  \    \$$\ /  $$| $$  \   | $$              |     $$    ", 13, 10
          db "                              | $$      | $$$$$     \$$\  $$ | $$$$$   | $$             __\$$$$$\    ", 13, 10
          db "                              | $$_____ | $$_____    \$$ $$  | $$_____ | $$_____       |  \__| $$    ", 13, 10
          db "                              | $$     \| $$     \    \$$$   | $$     \| $$     \       \$$    $$    ", 13, 10
          db "                               \$$$$$$$$ \$$$$$$$$     \$     \$$$$$$$$ \$$$$$$$$        \$$$$$$     ", 13, 10
          db 0                           
                                                               

                                                                   

Maze0     db " _____________________________________________________            ______________________________________ ",13,10
		  db "||                        ___                        ||          ||      ___   ___  ___   _ __  ___     ||",13,10
		  db "||  _______   _________  |   |  _________   _______  ||          ||     / __| / __|/ _ \ | '__|/ _ \    ||",13,10
		  db "|| |       | |         | |   | |         | |       | ||          ||     \__ \| (__| (_) || |  |  __/    ||",13,10
		  db "|| |_______| |_________| |___| |_________| |_______| ||          ||     |___/ \___|\___/ |_|   \___|    ||",13,10
		  db "||                                                   ||          ||                                     ||",13,10
		  db "||  _______   ___   _______________   ___   _______  ||          ||                                     ||",13,10
		  db "|| |_______| |   | |_____     _____| |   | |_______| ||          ||                                     ||",13,10
		  db "||           |   |       |   |       |   |           ||          ||                                     ||",13,10
		  db "||_________  |   |_____  |   |  _____|   |  _________||          ||                                     ||",13,10
		  db "||         | |    _____| |___| |_____    | |         ||          ||                                     ||",13,10
		  db "||         | |   |                   |   | |         ||          ||                                     ||",13,10
		  db "||         | |   |  ___         ___  |   | |         ||          ||                                     ||",13,10
		  db "||_________| |___| |   |       |   | |___| |_________||          ||                                     ||",13,10
		  db "|                  |   |       |   |                  |          ||                                     ||",13,10
		  db "||_________   ___  |   |       |   |  ___   _________||          ||                                     ||",13,10
		  db "||         | |   |  ---------------  |   | |         ||          ||                                     ||",13,10
		  db "||         | |   |                   |   | |         ||          ||                                     ||",13,10
		  db "||         | |   |  _______________  |   | |         ||          ||                                     ||",13,10
		  db "||_________| |___| |_____     _____| |___| |_________||          ||                                     ||",13,10
		  db "||                       |   |                       ||          ||                                     ||",13,10
		  db "||  _______   _________  |   |  _________   _______  ||          ||                                     ||",13,10
		  db "|| |___    | |_________| |___| |_________| |    ___| ||          ||                                     ||",13,10
		  db "||     |   |                               |   |     ||          ||                                     ||",13,10
		  db "||___  |   |  ___   _______________   ___  |   |  ___||          ||                                     ||",13,10
		  db "||___| |___| |   | |_____     _____| |   | |___| |___||          ||                                     ||",13,10
		  db "||           |   |       |   |       |   |           ||          ||                                     ||",13,10
		  db "||  _________|   |_____  |   |  _____|   |_________  ||          ||                                     ||",13,10
		  db "|| |___________________| |___| |___________________| ||          ||                                     ||",13,10
		  db "||                                                   ||          ||                                     ||",13,10
		  db "|_____________________________________________________|          ||_____________________________________||",13,10
          db 0

  Maze1   db " _____________________________________________________            _______________________________________ ",13,10 
		  db "||            ___                     ___            ||          ||       ___   ___  ___   _ __  ___    ||",13,10
		  db "||  _______  |   |  _______________  |   |  _______  ||          ||      / __| / __|/ _ \ | '__|/ _ \   ||",13,10
		  db "|| |    ___| |___| |_______________| |___| |___    | ||          ||      \__ \| (__| (_) || |  |  __/   ||",13,10
		  db "|| |   |                  ___                  |   | ||          ||      |___/ \___|\___/ |_|   \___|   ||",13,10
		  db "|| |   |  _______   ___  |   |  ___   _______  |   | ||          ||                                     ||",13,10
		  db "|| |___| |___    | |   | |   | |   | |    ___| |___| ||          ||                                     ||",13,10
		  db "|            |   | |   | |___| |   | |   |            |          ||                                     ||",13,10
		  db "||  _______  |   | |   |       |   | |   |  _______  ||          ||                                     ||",13,10
		  db "|| |       | |   | |    -------    | |   | |       | ||          ||                                     ||",13,10
		  db "|| |_______| |___| |_______________| |___| |_______| ||          ||                                     ||",13,10
		  db "||                                                   ||          ||                                     ||",13,10
		  db "|| __   _________   ___         ___   _________   __ ||          ||                                     ||",13,10
		  db "|||__| |_____    | |   |       |   | |    _____| |__|||          ||                                     ||",13,10
		  db "||           |   | |   |       |   | |   |           ||          ||                                     ||",13,10
		  db "||  _______  |   | |   |       |   | |   |  _______  ||          ||                                     ||",13,10
		  db "|| |___    | |___|  ---------------- |___| |    ___| ||          ||                                     ||",13,10
		  db "||     |   |                               |   |     ||          ||                                     ||",13,10
		  db "|| __  |   |  _________   ___   _________  |   |  __ ||          ||                                     ||",13,10
		  db "|||__| |___| |_____    | |   | |    _____| |___| |__|||          ||                                     ||",13,10
		  db "|                  |   | |   | |   |                  |          ||                                     ||",13,10
		  db "||  _____________  |   | |   | |   |  _____________  ||          ||                                     ||",13,10
		  db "|| |    _________| |___| |___| |___| |_________    | ||          ||                                     ||",13,10
		  db "|| |   |                                       |   | ||          ||                                     ||",13,10
		  db "|| |   |  ___   _______   ___   _______   ___  |   | ||          ||                                     ||",13,10
		  db "|| |___| |   | |_______| |   | |_______| |   | |___| ||          ||                                     ||",13,10
		  db "||       |___|           |___|           |___|       ||          ||                                     ||",13,10
		  db "||  _____________   _______________   _____________  ||          ||                                     ||",13,10
		  db "|| |_____________| |_______________| |_____________| ||          ||                                     ||",13,10
		  db "||                                                   ||          ||                                     ||",13,10
		  db "|_____________________________________________________|          ||_____________________________________||",13,10
          db 0

 Maze2    db " _____________________________________________________            _______________________________________ ",13,10
          db "||                                                   ||          ||     ___   ___  ___   _ __  ___      ||",13,10
          db "||  _______   ___   _______________   ___   _______  ||          ||    / __| / __|/ _ \ | '__|/ _ \     ||",13,10
          db "|| |    ___| |   | |    _______    | |   | |___    | ||          ||    \__ \| (__| (_) || |  |  __/     ||",13,10
          db "|| |   |     |   | |   |       |   | |   |     |   | ||          ||    |___/ \___|\___/ |_|   \___|     ||",13,10
          db "|| |   |  ___|   | |   |  ___  |   | |   |___  |   | ||          ||                                     ||",13,10
          db "|| |___| |___    | |   | |   | |   | |    ___| |___| ||          ||                                     ||",13,10
          db "||           |   | |___| |   | |___| |   |           ||          ||                                     ||",13,10
          db "||  _______  |   |       |   |       |   |  _______  ||          ||                                     ||",13,10
          db "|| |       | |   |  _____|   |_____  |   | |       | ||          ||                                     ||",13,10
          db "|| |_______| |___| |_______________| |___| |_______| ||          ||                                     ||",13,10
          db "||                                                   ||          ||                                     ||",13,10
          db "||  ___   _______   ___         ___   _______   ___  ||          ||                                     ||",13,10
          db "|| |   | |____   | |   |       |   | |    ___| |   | ||          ||                                     ||",13,10
          db "|| |   |     |   | |   |       |   | |   |     |   | ||          ||                                     ||",13,10
          db "|| |   |___  |   | |   |       |   | |   |  ___|   | ||          ||                                     ||",13,10
          db "|| |_______| |___| ----------------- |___| |_______| ||          ||                                     ||",13,10
          db "||                                                   ||          ||                                     ||",13,10
          db "|| ____   _____________   ___   _____________   ____ ||          ||                                     ||",13,10
          db "|||    | |    _________| |   | |_________    | |    |||          ||                                     ||",13,10
          db "|||    | |   |           |___|           |   | |    |||          ||                                     ||",13,10
          db "|||    | |   |  ___   ___________   ___  |   | |    |||          ||                                     ||",13,10
          db "|||____| |___| |   | |___________| |   | |___| |____|||          ||                                     ||",13,10
          db "|              |   |               |   |              |          ||                                     ||",13,10
          db "||_____   ___  |   |____   ___   __|   |  ___   ____ ||          ||                                     ||",13,10
          db "||_____| |   | |________| |   | |______| |   | |____|||          ||                                     ||",13,10
          db "||       |   |            |   |          |   |       ||          ||                                     ||",13,10
          db "||  _____|   |___   ______|   |____   ___|   |_____  ||          ||                                     ||",13,10
          db "|| |_____________| |_______________| |_____________| ||          ||                                     ||",13,10
          db "||                                                   ||          ||                                     ||",13,10
          db "|_____________________________________________________|          ||_____________________________________||",13,10
          db 0


snackcount0 dword 495
                  ;62 x1 55    |  28+27     3742-1 
Gamegrid0  db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2       
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2     
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1     
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2     
           db 2,2,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1     
           db 1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1     
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1     
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,1,6,1     
           db 9,1,4,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1    ; joking     
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1     
           db 1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2     
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1     
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2
           db 2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2     
           db 2,2,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2     
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1     
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2     
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2  

snackcount1 dword 525
Gamegrid1  db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2 
		   db 2,2,5,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,5,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
		   db 7,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,8,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2
		   db 2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2
		   db 2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,3,1
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2
		   db 2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,1,6,1
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,9,1
           db 4,1,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,2,2,2
		   db 2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2
		   db 2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2
		   db 7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
		   db 2,2,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
		   db 2,2,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,2,2,2
		   db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2

Gamegrid2  db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,1,2,1,2,1,2,1,2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1
           db 1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,4,1,1,1
           db 1,1,6,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,1,3,1
           db 1,1,9,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
           db 0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 7,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2
           db 2,2,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
           db 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
           db 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2

SND_ASYNC    dword 00001h  
SND_ALIAS    dword 10000h
SND_RESOURCE dword 40005h
SND_FILENAME dword 2000h
SND_FLAGS    dword 2001h
gamestartsound BYTE "C:\Users\Marhaba\Desktop\coal lab\PAC___MAN\pac_man\pac_man\maingamesound.wav",0
snackeatsound db  "C:\Users\Marhaba\Desktop\coal lab\PAC___MAN\pac_man\pac_man\eatsound.wav",0

fortyeight db 49
fortynine db 50
fifty db 51

Score dword 0           
snackscounter dword 1
player db '$'
ghost db '#'
snack db '.'
specialsnacks db '@'
replace db " "

gh1 db 0
sp1 db 0
sp2 db 0
sp3 db 0
sp4 db 0

file byte "Scores.txt", 0
handler HANDLE ?
array BYTE 1000 DUP(?)
username BYTE 50 DUP(?)
size1 DWORD ?
newline BYTE 0dh, 0ah, 0
score1 dword ?
counter dword 0
spaces byte " ",0

ghostinitial4X db 0
ghostinitial4Y db 0
ghostinitial3X db 0
ghostinitial3Y db 0
ghostinitial6X db 0
ghostinitial6Y db 0
ghostinitial9X db 0
ghostinitial9Y db 0
playerinitialX db 0
playerinitialY db 0

menuSelect db 1
exitGame db 0
playerX db 0
playerY db 0
playerXPrev db 0
playerYPrev db 0

ghost3X db 0
ghost3Y db 0
ghost4X db 0
ghost4Y db 0
ghost9X db 0
ghost9Y db 0
ghost6X db 0
ghost6Y db 0
ghost6XPrev db 0
ghost6YPrev db 0
ghost3XPrev db 0
ghost3YPrev db 0
ghost4XPrev db 0
ghost4YPrev db 0
ghost9XPrev db 0
ghost9YPrev db 0
ghost_timer  db 0      ; Timer for controlling ghost movement
ghost_speed  db 10     ; Adjust for desired ghost movement speed
num_ghosts   db 4      ; Number of ghosts in the game
ghost_positions dw 864, 866, 868, 870 ; Starting positions of ghosts

gtimeloop db 4
random_turn_interval BYTE 20      

movetype db 0
moveprev db 0
timee db 0

ranNum db 0
snackyes4 db 1
snackyes3 db 1
snackyes6 db 1
snackyes9 db 1
snackcheckgrid db 3742 DUP(1)
index dword 0   ; for storing the snack eatenup index

gamelevel db 1
rows1    db 0      
cols1    db 0      
x1    DWORD 31
y1 dword 56

playerlives dword 3
scaredghost db 0
transl BYTE 53
transr BYTE 1

triedUp dword 0
triedDown dword 0
triedLeft dword 0
triedRight dword 0
lloopp db 1

.code
main PROC
    call screenone
    call screentwo
    call clrscr
    exit                         ; Exit program
main ENDP

; screen number one
screenone PROC
    INVOKE PlaySound, OFFSET gamestartsound, NULL, SND_FLAGS
    mov  eax, yellow+(blue*16)
    call SetTextColor
    mov edx, offset screen1
loop1:
    mov al, [edx]
    cmp al, 0
    je l2
    call WriteChar
    call MyDelay
    inc edx
    jmp loop1

l2:
    mov edx, OFFSET file
    call openinputfile
    mov handler, eax

    cmp eax, 0                  ; Compare the handle with 0 (adjust based on your environment)
    je fnf					  ; If the file is not opened, jump to fnf

    mov eax, handler
    mov edx, OFFSET array
    mov ecx, 1000
    call readfromfile

    mov size1, eax

    mov eax, handler
    call closefile

    mov dl, 47
    mov dh, 22
    call gotoxy

    mov eax, OFFSET array
    add eax, size1           
    mov edx, eax          
    mov ecx, 50
    call readstring
    add size1, eax 

    ;copying it to the username array
    mov esi, OFFSET array       
    add esi, size1              
    sub esi, eax                
    mov edi, OFFSET username      
    mov ecx, eax                
    cld                         ; Clear the direction flag for forward movement
    rep movsb                   ; Copy bytes from array to copy
    jmp endl
    
fnf:
    mwrite "File is not opened"

endl:
    mov eax, white+(black*16)
    call SetTextColor
    ret
screenone ENDP

; gameover screen
gameoverscreen Proc
    call clrscr
    mov  eax, yellow+(blue*16)
    call SetTextColor
    xor eax, eax
    mov dl, 0
    mov dh, 10
    call gotoxy
    mov edx, offset gameOverScreen1
loop1:
    mov al, [edx]
    cmp al, 0
    je l2
    call WriteChar
    call MyDelay
    inc edx
    jmp loop1

l2:
    mov ecx, 10000
    call Delay
    ret
gameoverscreen ENDP

; screen number two
screentwo PROC
    mov menuSelect, 1           ; Default pointer to first option
    mainMenu:

    mov eax, yellow+(blue*16)
    call SetTextColor

    ; Render menu
    call clrscr
    mov dl, 0
    mov dh, 1
    call gotoxy
    mov edx, offset START
    call writestring

    mov dl, 0
    mov dh, 10
    call gotoxy
    mov edx, offset INSTRUCTIONS
    call writestring

    mov dl, 0
    mov dh, 20
    call gotoxy
    mov edx, offset EXITED
    call writestring

    ; Draw pointer
    call updatePointer

    ; will handle the user input
    call readchar
    cmp al, 'w'                 ; Move up1
    je moveUp
    cmp al, 's'                 ; Move down1
    je moveDown
    cmp al, 13                  ; Enter
    je selection
    jmp mainMenu                ; Loop back for invalid inputs

    moveUp:
        dec menuSelect
        cmp menuSelect, 0
        jl setLastOption        
        jmp mainMenu

    moveDown:
        inc menuSelect
        cmp menuSelect, 4
        jg setFirstOption     
        jmp mainMenu

    setFirstOption:
        mov menuSelect, 1
        jmp mainMenu

    setLastOption:
        mov menuSelect, 3
        jmp mainMenu

    selection:
        cmp menuSelect, 1
        je startGame
        cmp menuSelect, 2
        je instructionsScreen
        cmp menuSelect, 3
        je exitgame1
        jmp mainMenu

    startGame:
        call clrscr
        mov eax, white+(black*16)
        call SetTextColor
        call screenthree
        cmp exitGame, 1
        je exitgame1
        jmp mainMenu

    instructionsScreen:
        call clrscr
        mov dl, 0
        mov dh, 0
        call gotoxy
        mov edx, offset INSTRUCTIONS_SCREEN
    loop1:
        mov al, [edx]
        cmp al, 0
        je l2
        call WriteChar
        call MyDelay
        inc edx
        jmp loop1

    l2:
        call readchar
        cmp al, 27              ; if press escape Esc key
        je mainMenu
        jmp instructionsScreen  ; Loop in instructions screen

    exitgame1:
        call gameoverscreen
        ret
screentwo ENDP

; updating the pointer of the window
updatePointer PROC
    ; Clear old pointers
    mov dh, 6                   ; Default first pointer row
    mov dl, 80
    cmp menuSelect, 2
    jne skipPoint2

    mov dl, 113
    mov dh, 15
skipPoint2:
    cmp menuSelect, 3
    jne skipPoint3

    mov dl, 80
    mov dh, 26
skipPoint3:
    call gotoxy
    mov edx, offset POINTER
    call writestring
    ret
updatePointer ENDP

; screen number three
screenthree PROC
    mov menuSelect, 1           ; Default pointer to first option
    mainMenu:
    mov eax, yellow+(blue*16)
    call SetTextColor

    ; Render menu
    call clrscr
    mov dl, 0
    mov dh, 1
    call gotoxy
    mov edx, offset level1
    call writestring

    mov dl, 0
    mov dh, 10
    call gotoxy
    mov edx, offset level2
    call writestring

    mov dl, 0
    mov dh, 20
    call gotoxy
    mov edx, offset level3
    call writestring

    ; Draw pointer
    call updatePointer1

    ; will handle the user input
    call readchar
    cmp al, 'w' 
    je moveUp
    cmp al, 's'                 
    je moveDown
    cmp al, 13                  
    je selection
    cmp al, 27 
    je endmenu
    jmp mainMenu                 

    moveUp:
        dec menuSelect
        cmp menuSelect, 0
        jl setLastOption        
        jmp mainMenu

    moveDown:
        inc menuSelect
        cmp menuSelect, 4
        jg setFirstOption        
        jmp mainMenu

    setFirstOption:
        mov menuSelect, 1
        jmp mainMenu

    setLastOption:
        mov menuSelect, 3
        jmp mainMenu

    selection:
        cmp menuSelect, 1
        je levelone
        cmp menuSelect, 2
        je leveltwo
        cmp menuSelect, 3
        je levelthree
        jmp mainMenu

   levelone:
        mov playerlives, 3
        mov score, 0
        mov eax, White+(black*16)
        call SetTextColor
        mov gamelevel, 1
        call clrscr
        call actualgamescreen
        jmp mainMenu
   leveltwo:
        mov playerlives, 3
        mov score, 0
        mov eax, white+(black*16)
        call SetTextColor
        mov gamelevel, 2
        call clrscr
        call actualgamescreen
        jmp mainMenu
   levelthree:
        mov playerlives, 3
        mov score, 0
        mov eax, white+(black*16)
        call SetTextColor
        mov gamelevel, 3
        call clrscr
        call actualgamescreen
        cmp exitGame, 1
        je endMenu
        jmp mainMenu

        jmp endMenu

    endMenu:
        mov exitGame, 1
        ret
screenthree ENDP

; updating the pointer of the window
updatePointer1 PROC
    ; Clear old pointers
    mov dh, 5                  
    mov dl, 107
    cmp menuSelect, 2
    jne skipPoint2

    mov dl, 107
    mov dh, 15
skipPoint2:
    cmp menuSelect, 3
    jne skipPoint3

    mov dl, 107
    mov dh, 25
skipPoint3:
    call gotoxy
    mov edx, offset POINTER
    call writestring
    ret
updatePointer1 ENDP

; checkign which maze should be loaded
callformazecheck PROC
    cmp gamelevel, 1
    je startlevelone

    cmp gamelevel, 2
    je startleveltwo

    cmp gamelevel, 3
    je startlevelthree

startlevelone:
    mov eax, Yellow+(black*16)
    call SetTextColor
    xor edx, edx
    mov edx, offset Maze0
    jmp endl
startleveltwo:
    mov eax, Blue+(black*16)
    call SetTextColor
    xor edx, edx
    mov edx, offset Maze1
    jmp endl
startlevelthree:
    mov eax, Red+(black*16)
    call SetTextColor
    xor edx, edx
    mov edx, offset Maze2
    jmp endl

 endl:

    ret
callformazecheck ENDP

; check4 for the gamegrid for placing the players
callforgridcheck PROC
    cmp gamelevel, 1
    je startlevelone

    cmp gamelevel, 2
    je startleveltwo

    cmp gamelevel, 3
    je startlevelthree

startlevelone:
    mov eax, yellow+0
    call SetTextColor
    xor ebx, ebx
    mov ebx, offset Gamegrid0
    jmp endl
startleveltwo:
    mov eax, blue+0
    call SetTextColor
    xor ebx, ebx
    mov ebx, offset Gamegrid1
    jmp endl
startlevelthree:
    mov eax, red+0
    call SetTextColor
    xor ebx, ebx
    mov ebx, offset Gamegrid2
    jmp endl

 endl:

    ret
callforgridcheck ENDP

actualgamescreen PROC
    call callformazecheck

loop1:
    mov al, [edx]
    cmp al, 0
    je l2
    call WriteChar
    call MyDelay
    inc edx
    jmp loop1

l2:

    call playerplacing
    call playerMovement
    call readChar
    call clrscr
    ret
actualgamescreen ENDP

; ghost 9 movement
assigning_distances_ghost9 Proc
    xor eax, eax            
    xor ebx, ebx            
    xor ecx, ecx             
    xor edx, edx          

    mov dl, ghost9X            
    dec dl                   
    mov dh, ghost9Y
    cmp y9previous, dh     
    jne s1
    cmp x9previous, dl       
    je s2
s1:
    call calculate_distance
    mov distanceUp, cx        
s2:

    ; Distance for moving down1
    mov dl, ghost9X
    inc dl                    
    mov dh, ghost9Y
    cmp y9previous, dh       
    jne s3
    cmp x9previous, dl  
    je s4
s3:
    call calculate_distance
    mov distanceDown, cx     
s4:

    ; Distance for moving left1
    mov dl, ghost9X
    mov dh, ghost9Y
    dec dh                    
    cmp y9previous, dh
    jne s5
    cmp x9previous, dl   
    je s6
s5:
    call calculate_distance
    mov distanceLeft, cx      
s6:

    ; Distance for moving right1
    mov dl, ghost9X
    mov dh, ghost9Y
    inc dh                   
    cmp y9previous, dh       
    jne s7
    cmp x9previous, dl      
    je s8
s7:
    call calculate_distance
    mov distanceRight, cx    
s8:

    ret
assigning_distances_ghost9 ENDP

scaredghost9 Proc
     call levelcheckbaseddelay

    ; Save the previous position
    mov distanceUp, 0           
    mov distanceDown, 0       
    mov distanceLeft, 0       
    mov distanceRight, 0      


    call assigning_distances_ghost9

    dddd:

   xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jg shortestUpDown    
    mov ax, bx      
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jg shortestLeft       
    mov ax, bx            
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jg shortestRight      
    mov ax, bx             
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp               
    cmp ax, distanceDown
    je moveDown            
    cmp ax, distanceLeft
    je moveLeft             
    cmp ax, distanceRight
    je moveRight          

    jmp endl      

moveUp:
    dec ghost9X
    call ghost9_movements_checks
    cmp check9, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 0
    jmp dddd

moveDown:
    inc ghost9X
    call ghost9_movements_checks
    cmp check9, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 0
    jmp dddd

moveLeft:
    dec ghost9Y
    call ghost9_movements_checks
    cmp check9, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 0
    jmp dddd
moveRight:
    inc ghost9Y
    call ghost9_movements_checks
    cmp check9, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 0
    jmp dddd

endl:

    ret
scaredghost9 endp

moveGhost9 PROC

    cmp scaredGhostActive, 1
    jne kkll
    call scaredghost9
    jmp endl
    
kkll:
    call levelcheckbaseddelay

    ; Save the previous position
    mov distanceUp, 999            
    mov distanceDown, 999        
    mov distanceLeft, 999        
    mov distanceRight, 999       


    call assigning_distances_ghost9

    dddd:

   xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jl shortestUpDown      
    mov ax, bx            
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jl shortestLeft      
    mov ax, bx            
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jl shortestRight       
    mov ax, bx            
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp             
    cmp ax, distanceDown
    je moveDown             
    cmp ax, distanceLeft
    je moveLeft           
    cmp ax, distanceRight
    je moveRight           

    jmp endl      

moveUp:
    dec ghost9X
    call ghost9_movements_checks
    cmp check9, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 999
    jmp dddd

moveDown:
    inc ghost9X
    call ghost9_movements_checks
    cmp check9, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 999
    jmp dddd

moveLeft:
    dec ghost9Y
    call ghost9_movements_checks
    cmp check9, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 999
    jmp dddd
moveRight:
    inc ghost9Y
    call ghost9_movements_checks
    cmp check9, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 999
    jmp dddd

endl:
    ret

moveGhost9 ENDP

gamelevelcheckgrid proc
    cmp gamelevel, 1
    je l1
    cmp gamelevel, 2
    je l2
    mov esi, offset Gamegrid2
    ret
l1:
    mov esi, offset Gamegrid0
    ret
l2:
    mov esi, offset Gamegrid1
    ret
gamelevelcheckgrid endp

ghost9_movements_checks PROC
    movzx ebx, ghost9Y
    movzx eax, ghost9X
    imul eax, y1
    add eax, ebx

    mov cl, playerX
    cmp cl, ghost9X
    je chk1

endllll:
    call gamelevelcheckgrid
    mov cl, byte ptr [esi + eax]

    cmp cl, 2
    je invalidMove

    cmp cl, 1
    je finalizeMove

    cmp cl, 8
    je highjumpL

    cmp cl, 7
    je highjumpR

    cmp cl, 0
    je finalizeMove
    
    cmp cl, 9
    je finalizeMove

    cmp cl, 3
    je finalizeMove

    cmp cl, 6
    je finalizeMove

    cmp cl, 4
    je finalizeMove

    cmp cl, 5
    je finalizespecialMove

   jmp endl

   chk1:
    mov cl, playerY
    cmp cl, ghost9Y
    je ghostplayercolide
    jmp endllll
        
ghostplayercolide:
    mov check9, 0
    mov gh1, 9
    INVOKE GhostEatCheck, ghost9X, ghost9Y, ghostinitial9X, ghostinitial9Y, ghost9XPrev, ghost9YPrev, x9previous, y9previous
    jmp endl

highjumpR:
    mov check4, 0
    movzx ebx, transr
    movzx eax, ghost9X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, 1
    mov dh, ghost9X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement2
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjjj
skipsncakplacement2:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjjj:   
    
    mov al, transl
    mov ghost9Y, al
    mov dl, ghost9Y
    mov dh, ghost9X
    call gotoxy
    
    cmp scaredGhostActive, 1
    jne jjk
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp jjkk
jjk:
    mov eax, Brown+Brown*16
    call SetTextColor
jjkk:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

highjumpL:
    mov check9, 0
    movzx ebx, transl
    movzx eax, ghost9X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, transl
    mov dh, ghost9X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement1
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjj
skipsncakplacement1:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjj:

    mov ghost9Y, 1
    mov dl, ghost9Y
    mov dh, ghost9X
    call gotoxy
    
    cmp scaredGhostActive, 1
    jne jjkkkl
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp jjkkk
jjkkkl:
    mov eax, Brown+Brown*16
    call SetTextColor
jjkkk:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

finalizeMove:
    mov check9, 0
    movzx ebx, ghost9YPrev
    movzx eax, ghost9XPrev
    mov x9previous, al
    mov y9previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost9YPrev
    mov dh, ghost9XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar

    jmp jj

finalizespecialMove:
    mov check4, 0
    movzx ebx, ghost9YPrev
    movzx eax, ghost9XPrev
    mov x4previous, al
    mov y4previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost9YPrev
    mov dh, ghost9XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement

    mov al, specialsnacks
    call writeChar

    jmp jj

skipsncakplacement:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jj:

    xor ecx, ecx
    mov cl, ghost9Y
    mov ghost9YPrev, cl
    xor ecx, ecx
    mov cl, ghost9X
    mov ghost9XPrev, cl
    xor ecx, ecx

    mov dl, ghost9Y
    
    mov dh, ghost9X
    call gotoxy

    cmp scaredGhostActive, 1
    jne jjkkkll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp jjkkl
jjkkkll:
    mov eax, Brown+Brown*16
    call SetTextColor
jjkkl:
    xor eax, eax
    mov al, ghost
    call writeChar

    ret

invalidMove:
    mov check9, 1
    xor ecx, ecx
    mov cl, ghost9YPrev
    mov ghost9Y, cl
    xor ecx, ecx
    mov cl, ghost9XPrev
    mov ghost9X, cl
    xor ecx, ecx

    ret

endl:

    ret

ghost9_movements_checks ENDP

levelcheckbaseddelay PROC
    cmp gamelevel, 1
    je lone

    cmp gamelevel, 2
    je ltwo

    cmp gamelevel, 3
    je lthree

lone:
    mov ecx, 80000000
La:
    loop La
    jmp endl
ltwo:
    mov ecx, 80050000
Lb:
    loop Lb
    jmp endl
lthree:
    mov ecx, 90000000
Lc:
    loop Lc
    jmp endl

endl:
    ret
levelcheckbaseddelay ENDP

assigning_distances_ghost6 PROC
    ; Initialize registers
    xor eax, eax
    xor ebx, ebx

    ; Determine Target Tile (4th tile in Pac-Mans movement direction)
    mov al, playerX
    mov bl, playerY

    ; Pac-Man moving UP: Target 4 tiles above and 4 tiles left
    cmp up2, 1
    jne check_down
    sub bl, 2         
    sub al, 2          
    jmp check_target

check_down:
    cmp down2, 1
    jne check_left
    add bl, 2          
    jmp check_target

check_left:
    cmp left2, 1
    jne check_right
    sub al, 2         
    jmp check_target

check_right:
    cmp right2, 1
    jne check_target
    add al, 2          

check_target:
    ; Store Target Position
    mov targetX, 0
    mov targetY, 0
    mov targetX, al
    mov targetY, bl  
    mov al, ghost4X
    mov bl, ghost4Y
    sub al, targetX
    sub bl, targetY
    add al, ghost4X
    add bl, ghost4Y
    mov targetX, al
    mov targetY, bl

valid_target:
    ; Calculate distances in all four directions

    mov dl, ghost6X                  
    dec dl                     
    mov dh, ghost6Y                 
    cmp y6previous, dh       
    jne s1
    cmp x6previous, dl      
    je s2
s1:
    call calculate_distance_ghost6
    mov distanceUp, cx       
s2:
    ; Distance for moving down1
    mov dl, ghost6X
    inc dl                      
    mov dh, ghost6Y
    cmp y6previous, dh       
    jne s3
    cmp x6previous, dl      
    je s4
s3:
    call calculate_distance_ghost6
    mov distanceDown, cx      
s4:

    ; Distance for moving left1
    mov dl, ghost6X
    mov dh, ghost6Y
    dec dh                   
    cmp y6previous, dh       
    jne s5
    cmp x6previous, dl        
    je s6
s5:
    call calculate_distance_ghost6
    mov distanceLeft, cx     
s6:

    ; Distance for moving right1
    mov dl, ghost6X
    mov dh, ghost6Y
    inc dh                     
    cmp y6previous, dh       
    jne s7
    cmp x6previous, dl        
    je s8
s7:
    call calculate_distance_ghost6
    mov distanceRight, cx 
s8:

    ret

    ret
assigning_distances_ghost6 ENDP


calculate_distance_ghost6 PROC
       ; Calculate |playerX - ghostX|

    movzx cx, dl           
    movzx ax, targetX        
    sub cx, ax           
    jns skip_absX           
    neg cx                 
skip_absX:

    ; Calculate |playerY - ghostY|
    movzx bx, dh          
    movzx ax, targetY            
    sub bx, ax               
    jns skip_absY           
    neg bx                   
skip_absY:

    ; Add the two distances
    add cx, bx
    ret

calculate_distance_ghost6 ENDP

scaredghost6 Proc
    ; Save the previous position
    mov distanceUp, 0
    mov distanceDown, 0
    mov distanceLeft, 0
    mov distanceRight, 0

    call assigning_distances_ghost6

    dddd:

    xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jg shortestUpDown     
    mov ax, bx            
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jg shortestLeft        
    mov ax, bx 
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jg shortestRight      
    mov ax, bx           
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp               
    cmp ax, distanceDown
    je moveDown            
    cmp ax, distanceLeft
    je moveLeft             
    cmp ax, distanceRight
    je moveRight           

    jmp endl     

moveUp:
    dec ghost6X
    call ghost6_movements_checks
    cmp check6, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 0
    jmp dddd

moveDown:
    inc ghost6X
    call ghost6_movements_checks
    cmp check6, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 0
    jmp dddd

moveLeft:
    dec ghost6Y
    call ghost6_movements_checks
    cmp check6, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 0
    jmp dddd
moveRight:
    inc ghost6Y
    call ghost6_movements_checks
    cmp check6, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 0
    jmp dddd

endl:
    ret

scaredghost6 endp

moveGhost6 PROC

    cmp scaredGhostActive, 1
    jne kkk
    call scaredghost6
    jmp endl

kkk:
    call levelcheckbaseddelay

    ; Save the previous position
    mov distanceUp, 999
    mov distanceDown, 999
    mov distanceLeft, 999
    mov distanceRight, 999

    call assigning_distances_ghost6

    dddd:

    xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jl shortestUpDown    
    mov ax, bx             
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jl shortestLeft      
    mov ax, bx             
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jl shortestRight     
    mov ax, bx              
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp               
    cmp ax, distanceDown
    je moveDown             
    cmp ax, distanceLeft
    je moveLeft             
    cmp ax, distanceRight
    je moveRight           

    jmp endl     

moveUp:
    dec ghost6X
    call ghost6_movements_checks
    cmp check6, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 999
    jmp dddd

moveDown:
    inc ghost6X
    call ghost6_movements_checks
    cmp check6, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 999
    jmp dddd

moveLeft:
    dec ghost6Y
    call ghost6_movements_checks
    cmp check6, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 999
    jmp dddd
moveRight:
    inc ghost6Y
    call ghost6_movements_checks
    cmp check6, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 999
    jmp dddd

endl:
    ret

moveGhost6 ENDP

ghost6_movements_checks PROC
     movzx ebx, ghost6Y
    movzx eax, ghost6X
    imul eax, y1
    add eax, ebx

    mov cl, playerX
    cmp cl, ghost6X
    je chk1

endllll:
    call gamelevelcheckgrid
    mov cl, byte ptr [esi + eax]

    cmp cl, 2
    je invalidMove

    cmp cl, 1
    je finalizeMove

    cmp cl, 8
    je highjumpL

    cmp cl, 7
    je highjumpR

    cmp cl, 0
    je finalizeMove

    cmp cl, 4
    je finalizeMove

    cmp cl, 3
    je finalizeMove

    cmp cl, 9
    je finalizeMove

    cmp cl, 5
    je finalizespecialMove

   jmp endl

chk1:
    mov cl, playerY
    cmp cl, ghost6Y
    je ghostplayercolide
    jmp endllll

ghostplayercolide:
    mov check6, 0
    mov gh1, 6
    INVOKE GhostEatCheck, ghost6X, ghost6Y, ghostinitial6X, ghostinitial6Y, ghost6XPrev, ghost6YPrev, x6previous, y6previous
    jmp endl

highjumpR:
    mov check6, 0
    movzx ebx, transr
    movzx eax, ghost6X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, 1
    mov dh, ghost6X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement2
    
    cmp scaredGhostActive, 1
    jne kkkl
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kkl
kkkl:
    mov eax, Yellow+Yellow*16
    call SetTextColor
kkl:
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjjj
skipsncakplacement2:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjjj:   
    
    mov al, transl
    mov ghost6Y, al
    mov dl, ghost6Y
    mov dh, ghost6X
    call gotoxy

    cmp scaredGhostActive, 1
    jne kkkll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kkll
kkkll:
    mov eax, Yellow+Yellow*16
    call SetTextColor
kkll:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

highjumpL:
    mov check6, 0
    movzx ebx, transl
    movzx eax, ghost6X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, transl
    mov dh, ghost6X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement1
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjj
skipsncakplacement1:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjj:

    mov ghost6Y, 1
    mov dl, ghost6Y
    mov dh, ghost6X
    call gotoxy
    cmp scaredGhostActive, 1
    jne kkklll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kkllll
kkklll:
    mov eax, Yellow+Yellow*16
    call SetTextColor
kkllll:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

finalizeMove:
    mov check6, 0
    movzx ebx, ghost6YPrev
    movzx eax, ghost6XPrev
    mov x6previous, al
    mov y6previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost6YPrev
    mov dh, ghost6XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jj
skipsncakplacement:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jj:

    xor ecx, ecx
    mov cl, ghost6Y
    mov ghost6YPrev, cl
    xor ecx, ecx
    mov cl, ghost6X
    mov ghost6XPrev, cl
    xor ecx, ecx

    mov dl, ghost6Y
    
    mov dh, ghost6X
    call gotoxy
    cmp scaredGhostActive, 1
    jne kkkllll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kklllll
kkkllll:
    mov eax, Yellow+Yellow*16
    call SetTextColor
kklllll:
    xor eax, eax
    mov al, ghost
    call writeChar

    ret

finalizespecialMove:
    mov check6, 0
    movzx ebx, ghost6YPrev
    movzx eax, ghost6XPrev
    mov x6previous, al
    mov y6previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost6YPrev
    mov dh, ghost6XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement

    mov al, specialsnacks
    call writeChar
    jmp jj

invalidMove:
    mov check6, 1
    xor ecx, ecx
    mov cl, ghost6YPrev
    mov ghost6Y, cl
    xor ecx, ecx
    mov cl, ghost6XPrev
    mov ghost6X, cl
    xor ecx, ecx

    ret

endl:

    ret

ghost6_movements_checks ENDP

assigning_distances_ghost3 PROC
    ; Initialize registers
    xor eax, eax
    xor ebx, ebx
    mov al, playerX
    mov bl, playerY

    ; Pac-Man moving UP: Target 4 tiles above and 4 tiles left
    cmp up1, 1
    jne check_down
    sub bl, 4         
    sub al, 4        
    jmp check_target

check_down:
    cmp down1, 1
    jne check_left
    add bl, 4         
    jmp check_target

check_left:
    cmp left1, 1
    jne check_right
    sub al, 4     
    jmp check_target

check_right:
    cmp right1, 1
    jne check_target
    add al, 4        

check_target:
    mov targetX, al
    mov targetY, bl  

    ; Check if Target X is negative
    test al, 80h         
    jz check_targetY      
    mov al, playerX      
    mov targetX, al 

check_targetY:
    test bl, 80h          
    jz valid_target      
    mov al, playerY     
    mov targetY, al 

valid_target:
    ; Calculate distances in all four directions

    mov dl, ghost3X              
    dec dl                    
    mov dh, ghost3Y           
    cmp y3previous, dh       
    jne s1
    cmp x3previous, dl        
    je s2
s1:
    call calculate_distance_ghost3
    mov distanceUp, cx   
s2:

    ; Distance for moving down1
    mov dl, ghost3X
    inc dl                     
    mov dh, ghost3Y
    cmp y3previous, dh       
    jne s3
    cmp x3previous, dl       
    je s4
s3:
    call calculate_distance_ghost3
    mov distanceDown, cx      
s4:

    ; Distance for moving left1
    mov dl, ghost3X
    mov dh, ghost3Y
    dec dh                   
    cmp y3previous, dh       
    jne s5
    cmp x3previous, dl       
    je s6
s5:
    call calculate_distance_ghost3
    mov distanceLeft, cx  
s6:

    ; Distance for moving right1
    mov dl, ghost3X
    mov dh, ghost3Y
    inc dh                    
    cmp y3previous, dh       
    jne s7
    cmp x3previous, dl       
    je s8
s7:
    call calculate_distance_ghost3
    mov distanceRight, cx    
s8:

    ret

    ret
assigning_distances_ghost3 ENDP


calculate_distance_ghost3 PROC
       ; Calculate |playerX - ghostX|

    movzx cx, dl            
    movzx ax, targetX           
    sub cx, ax            
    jns skip_absX           
    neg cx                  
skip_absX:

    ; Calculate |playerY - ghostY|
    movzx bx, dh          
    movzx ax, targetY          
    sub bx, ax             
    jns skip_absY         
    neg bx                  
skip_absY:

    ; Add the two distances
    add cx, bx
    ret

calculate_distance_ghost3 ENDP

scaredghost3 Proc
    ; Save the previous position
    mov distanceUp, 0
    mov distanceDown, 0
    mov distanceLeft, 0
    mov distanceRight, 0

    call assigning_distances_ghost3

    dddd:

    xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jg shortestUpDown   
    mov ax, bx          
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jg shortestLeft  
    mov ax, bx              
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jg shortestRight       
    mov ax, bx             
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp              
    cmp ax, distanceDown
    je moveDown            
    cmp ax, distanceLeft
    je moveLeft          
    cmp ax, distanceRight
    je moveRight            

    jmp endl      

moveUp:
    dec ghost3X
    call ghost3_movements_checks
    cmp check3, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 0
    jmp dddd

moveDown:
    inc ghost3X
    call ghost3_movements_checks
    cmp check3, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 0
    jmp dddd

moveLeft:
    dec ghost3Y
    call ghost3_movements_checks
    cmp check3, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 0
    jmp dddd
moveRight:
    inc ghost3Y
    call ghost3_movements_checks
    cmp check3, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 0
    jmp dddd

endl:
    ret

scaredghost3 endp

moveghost3 PROC

    cmp scaredGhostActive, 1
    jne kkk
    call scaredghost3
    jmp endl

kkk:
    call levelcheckbaseddelay

    ; Save the previous position
    mov distanceUp, 999
    mov distanceDown, 999
    mov distanceLeft, 999
    mov distanceRight, 999

    call assigning_distances_ghost3

    dddd:

    xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jl shortestUpDown      
    mov ax, bx             
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jl shortestLeft      
    mov ax, bx           
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jl shortestRight      
    mov ax, bx           
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp              
    cmp ax, distanceDown
    je moveDown            
    cmp ax, distanceLeft
    je moveLeft            
    cmp ax, distanceRight
    je moveRight           
    jmp endl    

moveUp:
    dec ghost3X
    call ghost3_movements_checks
    cmp check3, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 999
    jmp dddd

moveDown:
    inc ghost3X
    call ghost3_movements_checks
    cmp check3, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 999
    jmp dddd

moveLeft:
    dec ghost3Y
    call ghost3_movements_checks
    cmp check3, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 999
    jmp dddd
moveRight:
    inc ghost3Y
    call ghost3_movements_checks
    cmp check3, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 999
    jmp dddd

endl:
    ret
moveghost3 ENDP

ghost3_movements_checks PROC
    movzx ebx, ghost3Y
    movzx eax, ghost3X
    imul eax, y1
    add eax, ebx

    mov cl, playerX
    cmp cl, ghost3X
    je chk1

endllll:
    call gamelevelcheckgrid
    mov cl, byte ptr [esi + eax]

    cmp cl, 2
    je invalidMove

    cmp cl, 1
    je finalizeMove

    cmp cl, 8
    je highjumpL

    cmp cl, 7
    je highjumpR

    cmp cl, 0
    je finalizeMove

    cmp cl, 4
    je finalizeMove

    cmp cl, 6
    je finalizeMove

    cmp cl, 9
    je finalizeMove

    cmp cl, 5
    je finalizespecialMove

   jmp endl

chk1:
    mov cl, playerY
    cmp cl, ghost3Y
    je ghostplayercolide
    jmp endllll

ghostplayercolide:
    mov check3, 0
    mov gh1, 3
    INVOKE GhostEatCheck, ghost3X, ghost3Y, ghostinitial3X, ghostinitial3Y, ghost3XPrev, ghost3YPrev, x3previous, y3previous
    jmp endl

highjumpR:
    mov check3, 0
    movzx ebx, transr
    movzx eax, ghost3X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, 1
    mov dh, ghost3X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement2
    
    cmp scaredGhostActive, 1
    jne kkkl
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kkl
kkkl:
    mov eax, Magenta+Magenta*16
    call SetTextColor
kkl:
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjjj
skipsncakplacement2:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjjj:   
    
    mov al, transl
    mov ghost3Y, al
    mov dl, ghost3Y
    mov dh, ghost3X
    call gotoxy

    cmp scaredGhostActive, 1
    jne kkkll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kkll
kkkll:
    mov eax, Magenta+Magenta*16
    call SetTextColor
kkll:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

highjumpL:
    mov check3, 0
    movzx ebx, transl
    movzx eax, ghost3X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, transl
    mov dh, ghost3X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement1
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjj
skipsncakplacement1:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjj:

    mov ghost3Y, 1
    mov dl, ghost3Y
    mov dh, ghost3X
    call gotoxy
    cmp scaredGhostActive, 1
    jne kkklll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kkllll
kkklll:
    mov eax, Magenta+Magenta*16
    call SetTextColor
kkllll:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

finalizeMove:
    mov check3, 0
    movzx ebx, ghost3YPrev
    movzx eax, ghost3XPrev
    mov x3previous, al
    mov y3previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost3YPrev
    mov dh, ghost3XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jj
skipsncakplacement:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jj:

    xor ecx, ecx
    mov cl, ghost3Y
    mov ghost3YPrev, cl
    xor ecx, ecx
    mov cl, ghost3X
    mov ghost3XPrev, cl
    xor ecx, ecx

    mov dl, ghost3Y
    
    mov dh, ghost3X
    call gotoxy
    cmp scaredGhostActive, 1
    jne kkkllll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp kklllll
kkkllll:
    mov eax, Magenta+Magenta*16
    call SetTextColor
kklllll:
    xor eax, eax
    mov al, ghost
    call writeChar

    ret

finalizespecialMove:
    mov check3, 0
    movzx ebx, ghost3YPrev
    movzx eax, ghost3XPrev
    mov x3previous, al
    mov y3previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost3YPrev
    mov dh, ghost3XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement

    mov al, specialsnacks
    call writeChar
    jmp jj

invalidMove:
    mov check3, 1
    xor ecx, ecx
    mov cl, ghost3YPrev
    mov ghost3Y, cl
    xor ecx, ecx
    mov cl, ghost3XPrev
    mov ghost3X, cl
    xor ecx, ecx

    ret

endl:

    ret

ghost3_movements_checks ENDP

assigning_distances Proc
    ; Initialize variables for calculating Manhattan distances
    xor eax, eax             
    xor ebx, ebx             
    xor ecx, ecx             
    xor edx, edx              

    ; Distance for moving up1
    mov dl, ghost4X                
    dec dl                    
    mov dh, ghost4Y                
    cmp y4previous, dh        
    jne s1
    cmp x4previous, dl        
    je s2
s1:
    call calculate_distance
    mov distanceUp, cx        
s2:

    ; Distance for moving down1
    mov dl, ghost4X
    inc dl                   
    mov dh, ghost4Y
    cmp y4previous, dh       
    jne s3
    cmp x4previous, dl       
    je s4
s3:
    call calculate_distance
    mov distanceDown, cx      
s4:

    ; Distance for moving left1
    mov dl, ghost4X
    mov dh, ghost4Y
    dec dh                    
    cmp y4previous, dh       
    jne s5
    cmp x4previous, dl      
    je s6
s5:
    call calculate_distance
    mov distanceLeft, cx      
s6:

    ; Distance for moving right1
    mov dl, ghost4X
    mov dh, ghost4Y
    inc dh                    
    cmp y4previous, dh      
    jne s7
    cmp x4previous, dl      
    je s8
s7:
    call calculate_distance
    mov distanceRight, cx      ; Store distance
s8:

    ret
assigning_distances ENDP

scaredghost4 Proc
     call levelcheckbaseddelay

    ; Save the previous position
    mov distanceUp, 0           
    mov distanceDown, 0         
    mov distanceLeft, 0      
    mov distanceRight, 0      


    call assigning_distances

    dddd:

   xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jg shortestUpDown      
    mov ax, bx             
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jg shortestLeft        
    mov ax, bx            
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jg shortestRight       
    mov ax, bx            
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp               
    cmp ax, distanceDown
    je moveDown             
    cmp ax, distanceLeft
    je moveLeft
    cmp ax, distanceRight
    je moveRight            

    jmp endl       

moveUp:
    dec ghost4X
    call ghost4_movements_checks
    cmp check4, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 0
    jmp dddd

moveDown:
    inc ghost4X
    call ghost4_movements_checks
    cmp check4, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 0
    jmp dddd

moveLeft:
    dec ghost4Y
    call ghost4_movements_checks
    cmp check4, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 0
    jmp dddd
moveRight:
    inc ghost4Y
    call ghost4_movements_checks
    cmp check4, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 0
    jmp dddd

endl:

    ret
scaredghost4 endp

moveGhost4 PROC

    cmp scaredGhostActive, 1
    jne kkk
    call scaredghost4
    jmp endl

kkk:
    call levelcheckbaseddelay

    ; Save the previous position
    mov distanceUp, 999           
    mov distanceDown, 999         
    mov distanceLeft, 999       
    mov distanceRight, 999     


    call assigning_distances

    dddd:

   xor eax, eax
    mov ax, distanceUp
    mov bx, distanceDown
    cmp ax, bx
    jl shortestUpDown     
    mov ax, bx            
shortestUpDown:
    mov bx, distanceLeft
    cmp ax, bx
    jl shortestLeft        
    mov ax, bx             
shortestLeft:
    mov bx, distanceRight
    cmp ax, bx
    jl shortestRight    
    mov ax, bx       
shortestRight:

    ; Determine the direction based on the shortest distance
    cmp ax, distanceUp
    je moveUp              
    cmp ax, distanceDown
    je moveDown           
    cmp ax, distanceLeft
    je moveLeft            
    cmp ax, distanceRight
    je moveRight            

    jmp endl      

moveUp:
    dec ghost4X
    call ghost4_movements_checks
    cmp check4, 1
    je moveDown1
    jmp endl

moveDown1:
    mov distanceUp, 999
    jmp dddd

moveDown:
    inc ghost4X
    call ghost4_movements_checks
    cmp check4, 1
    je moveLeft1
    jmp endl

moveLeft1:
    mov distanceDown, 999
    jmp dddd

moveLeft:
    dec ghost4Y
    call ghost4_movements_checks
    cmp check4, 1
    je moveRight1
    jmp endl

moveRight1:
    mov distanceLeft, 999
    jmp dddd
moveRight:
    inc ghost4Y
    call ghost4_movements_checks
    cmp check4, 1
    je moveUp1
    jmp endl

moveUp1:
    mov distanceRight, 999
    jmp dddd

endl:
    ret

moveGhost4 ENDP

; Calculate Manhattan distance
calculate_distance PROC
    movzx cx, dl           
    movzx ax, playerX           
    sub cx, ax             
    jns skip_absX           
    neg cx                  
skip_absX:

    ; Calculate |playerY - ghostY|
    movzx bx, dh           
    movzx ax, playerY          
    sub bx, ax               
    jns skip_absY
    neg bx                   
skip_absY:

    ; Add the two distances
    add cx, bx
    ret

calculate_distance ENDP

ghost4_movements_checks PROC
    movzx ebx, ghost4Y
    movzx eax, ghost4X
    imul eax, y1
    add eax, ebx

    mov cl, playerX
    cmp cl, ghost4X
    je chk1

endllll:
   call gamelevelcheckgrid
    mov cl, byte ptr [esi + eax]

    cmp cl, 2
    je invalidMove

    cmp cl, 1
    je finalizeMove

    cmp cl, 8
    je highjumpL

    cmp cl, 7
    je highjumpR

    cmp cl, 0
    je finalizeMove
    
    cmp cl, 4
    je finalizeMove

    cmp cl, 3
    je finalizeMove

    cmp cl, 6
    je finalizeMove

    cmp cl, 9
    je finalizeMove

    cmp cl, 5
    je finalizespecialMove

   jmp endl

   chk1:
    mov cl, playerY  
    cmp cl, ghost4Y
    je ghostplayercolide
    jmp endllll

ghostplayercolide:
    mov check4, 0
    mov gh1, 4
    INVOKE GhostEatCheck, ghost4X, ghost4Y, ghostinitial4X, ghostinitial4Y, ghost4XPrev, ghost4YPrev, x4previous, y4previous
    jmp endl

highjumpR:
    mov check4, 0
    movzx ebx, transr
    movzx eax, ghost4X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, 1
    mov dh, ghost4X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement2
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjjj
skipsncakplacement2:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjjj:   
    
    mov al, transl
    mov ghost4Y, al
    mov dl, ghost4Y
    mov dh, ghost4X
    call gotoxy
    
    cmp scaredGhostActive, 1
    jne jjk
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp jjkk
jjk:
    mov eax, Red+Red*16
    call SetTextColor
jjkk:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

highjumpL:
    mov check4, 0
    movzx ebx, transl
    movzx eax, ghost4X
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, transl
    mov dh, ghost4X
    call gotoxy

    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement1
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar
    jmp jjj
skipsncakplacement1:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jjj:

    mov ghost4Y, 1
    mov dl, ghost4Y
    mov dh, ghost4X
    call gotoxy
    
    cmp scaredGhostActive, 1
    jne jjkkkl
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp jjkkk
jjkkkl:
    mov eax, Red+Red*16
    call SetTextColor
jjkkk:
    xor eax, eax
    mov al, ghost
    call writeChar
    jmp endl

finalizeMove:
    mov check4, 0
    movzx ebx, ghost4YPrev
    movzx eax, ghost4XPrev
    mov x4previous, al
    mov y4previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost4YPrev
    mov dh, ghost4XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call writeChar

    jmp jj

finalizespecialMove:
    mov check4, 0
    movzx ebx, ghost4YPrev
    movzx eax, ghost4XPrev
    mov x4previous, al
    mov y4previous, bl
    imul eax, y1
    add eax, ebx
    mov index, eax

    mov dl, ghost4YPrev
    mov dh, ghost4XPrev
    call gotoxy
       
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je skipsncakplacement

    mov al, specialsnacks
    call writeChar

    jmp jj

skipsncakplacement:
    mov eax, 0+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writechar
jj:

    xor ecx, ecx
    mov cl, ghost4Y
    mov ghost4YPrev, cl
    xor ecx, ecx
    mov cl, ghost4X
    mov ghost4XPrev, cl
    xor ecx, ecx

    mov dl, ghost4Y
    
    mov dh, ghost4X
    call gotoxy

    cmp scaredGhostActive, 1
    jne jjkkkll
    mov eax, Cyan+Cyan*16
    call SetTextColor
    jmp jjkkl
jjkkkll:
    mov eax, Red+Red*16
    call SetTextColor
jjkkl:
    xor eax, eax
    mov al, ghost
    call writeChar

    ret

invalidMove:
    mov check4, 1
    xor ecx, ecx
    mov cl, ghost4YPrev
    mov ghost4Y, cl
    xor ecx, ecx
    mov cl, ghost4XPrev
    mov ghost4X, cl
    xor ecx, ecx

    ret

endl:

    ret

ghost4_movements_checks ENDP

generate_random PROC
    mov eax, 4
    call RandomRange
    mov ranNum, al
    ret
generate_random ENDP

settinglevelcolor proc

    cmp gamelevel, 1
    je levelone
    cmp gamelevel, 2
    je leveltwo
    cmp gamelevel, 3
    je levelthree

    levelone:
    mov eax, yellow+0
    call SetTextColor
    ret

    leveltwo:
    mov eax, blue+0
    call SetTextColor
    ret

    levelthree:
    mov eax, red+0
    call SetTextColor
    ret

settinglevelcolor ENDP

; this procedure for the player placing
playerplacing PROC
    xor edx, edx   
    call callforgridcheck
    mov esi, 0           

findZero:
    cmp edx, 1           
    je done

    mov al, [ebx + esi]   

    cmp al, 0           
    je settingplayer
    
    cmp al, 1
    je settingsnacks

   cmp al, 4
   je settingghosts

   cmp al, 3
   je settingghosts

   cmp al, 6
   je settingghosts

   cmp al, 9
   je settingghosts

   cmp al, 5
   je settingspecialsnacks

next:
    inc esi               
    cmp esi, 1736     
    jl findZero            

    jmp done

settingPlayer:
    mov eax, esi                
    xor edx, edx             
    div y1                        
    mov playerY, dl            
    mov playerX, al             

    ; Move to calculated position and place the player
    mov dl, playerY
    mov dh, playerX
    mov playerinitialX, dh
    mov playerinitialY, dl
    call gotoxy

    mov al, player                ; Set player character
    call WriteChar
    jmp next

settingsnacks:      ;-----------snackssetting
    mov eax, white+0
    call SetTextColor
    xor edx, edx          
    mov eax, esi         
    div y1                 
    mov rows1, al        
    mov cols1, dl       

    ; Move to calculated position
    mov dl, BYTE PTR cols1
    mov dh, BYTE PTR rows1
    call gotoxy
    mov eax, white+0
    call SetTextColor
    xor eax, eax
    mov al, snack
    call WriteChar
    ; Mark as found
    call settinglevelcolor
    jmp next

settingghosts:      ;-----------ghostsetting
    xor ecx, ecx
    mov cl, al
    xor edx, edx          
    mov eax, esi         
    div y1                 
    mov rows1, al        
    mov cols1, dl          

    ; Move to calculated position
    mov dl, BYTE PTR cols1
    mov dh, BYTE PTR rows1

    cmp cl, 4
    je ghost4

    cmp cl, 3
    je ghost3

    cmp cl, 6
    je ghost6

    jmp ghost9

ghost4:
    ;mov dh, 11
    ;mov dl, 18
    mov ghost4X, dh
    mov x4previous, dh
    mov y4previous, dl
    mov ghost4XPrev, dh
    mov ghost4Y, dl
    mov ghost4YPrev, dl
    mov ghostinitial4x, dh
    mov ghostinitial4y, dl
    jmp gotoo

ghost3:
    mov ghost3X, dh
    mov x3previous, dh
    mov y3previous, dl
    mov ghost3XPrev, dh
    mov ghost3Y, dl
    mov ghost3YPrev, dl
    mov ghostinitial3x, dh
    mov ghostinitial3y, dl
    jmp gotoo

ghost6:
    mov ghost6X, dh
    mov x6previous, dh
    mov y6previous, dl
    mov ghost6XPrev, dh
    mov ghost6Y, dl
    mov ghost6YPrev, dl
    mov ghostinitial6x, dh
    mov ghostinitial6y, dl
    jmp gotoo

ghost9:
    mov ghost9X, dh
    mov x9previous, dh
    mov y9previous, dl
    mov ghost9XPrev, dh
    mov ghost9Y, dl
    mov ghost9YPrev, dl
    mov ghostinitial9x, dh
    mov ghostinitial9y, dl
   
gotoo:
    call gotoxy

    mov al, ghost
    call WriteChar
    jmp next

settingspecialsnacks:      ;-----------specialsnackssetting
    xor edx, edx          
    mov eax, esi         
    div y1            
    mov rows1, al        
    mov cols1, dl          

    ; Move to calculated position
    mov dl, BYTE PTR cols1
    mov dh, BYTE PTR rows1
    call gotoxy

    mov al, specialsnacks
    call WriteChar
    ; Mark as found
    jmp next

done:
    mov dl, 74
    mov dh, 6
    call gotoxy
    mwrite "Username: "
    mov edx, offset username
    call writestring

    mov dl, 74
    mov dh, 7
    call gotoxy
    mwrite "Score: "

    mov dl, 74
    mov dh, 8
    call gotoxy
    mwrite "Lives: "
    mov eax, playerlives
    call writedec

    mov dl, 74
    mov dh, 9
    call gotoxy
    mwrite "Level: "
    xor eax, eax
    mov al, gamelevel
    call writedec

    mov dl, 74
    mov dh, 10
    call gotoxy
    mwrite "Time: "
    mov eax, 0
    call writedec

    ret
playerplacing ENDP

callforplayerMovement PROC
    cmp gamelevel, 1
    je startlevelone

    cmp gamelevel, 2
    je startleveltwo

    cmp gamelevel, 3
    je startlevelthree

    mov sp1, 0
    mov sp2, 0
    mov sp3, 0
    mov sp4, 0

startlevelone:
    mov ecx, snackcount0
    mov snackscounter, ecx
    xor ecx, ecx
    xor esi, esi
    mov esi, offset Gamegrid0
    jmp endl
startleveltwo:
    mov ecx, snackcount1
    mov snackscounter, ecx
    xor ecx, ecx
    xor esi, esi
    mov esi, offset Gamegrid1
    jmp endl
startlevelthree:
    mov ecx, snackcount1
    mov snackscounter, ecx
    xor ecx, ecx
    xor esi, esi
    mov esi, offset Gamegrid2
    jmp endl

 endl:
    ret
callforplayerMovement ENDP

; Timer function to handle scared ghost timing based on scaredGhostActive
ScaredGhostTimer PROC
    mov dl, 80            
    mov dh, 10              
    call gotoxy             

    cmp scaredGhostActive, 1
    jne ResetTimer          

    ; Start scared ghost timer if scaredGhostActive is 1
    cmp timerInitialized, 1
    jne InitializeTimer      

    ; Timer is initialized, check4 elapsed time
    call GetMseconds       
    mov ebx, scaredStartTime  
    sub eax, ebx             
    cmp eax, 20000            
    jl DisplayElapsedTime     

    ; Reset scaredGhostActive and stop timer
    mov scaredGhostActive, 0  
    mov timerInitialized, 0  
    jmp DisplayZero           

DisplayElapsedTime:
    mov ecx, 1000            
    xor edx, edx              
    div ecx                   
    call writedec           
    ret

DisplayZero:
    mwrite "0 "
    ret

InitializeTimer:
    ; Initialize scared ghost timer
    call GetMseconds       
    mov scaredStartTime, eax  
    mov timerInitialized, 1   
    ret

ResetTimer:
    ; Reset the timer if scaredGhostActive is 0
    mov scaredGhostActive, 0
    mov timerInitialized, 0
    jmp DisplayZero

ScaredGhostTimer ENDP


; procedure for the player movement
playerMovement PROC
    call settinglevelcolor
    mov up1, 0
    mov down1, 0
    mov left1, 0
    mov right1, 0
    mov up2, 0
    mov down2, 0
    mov left2, 0
    mov right2, 0

    cmp playerlives, 0
    je endGame
    cmp snackscounter, 0
    je endGame

    ; calling for scared ghost check4
    call ScaredGhostTimer

   cmp lloopp, 1
   je ghost4time
   cmp lloopp, 2   
   je ghost3time
   cmp lloopp, 3
   je ghost6time
   cmp lloopp, 4
   je ghost9time

ghost4time:
   call moveGhost4
    inc lloopp
    jmp stt

ghost3time:
    call moveghost3
    inc lloopp
    jmp stt

ghost6time:
    call moveGhost6
    inc lloopp
    jmp stt

ghost9time:
    call moveGhost9
    mov lloopp, 1

stt:
    xor eax, eax
    xor ecx, ecx
    mov cl, playerXPrev
    mov pXprevious, cl
    mov cl, playerYPrev
    mov pYprevious, cl
    xor ecx, ecx
    mov cl, playerY
    mov playerYPrev, cl
    xor ecx, ecx
    mov cl, playerX
    mov playerXPrev, cl
    xor ecx, ecx
    
    mov dl, playerY        
    mov dh, playerX         
    call gotoxy
    xor eax, eax
    mov eax, 0+Black*16
    call SetTextColor
    call ReadKey             
    cmp al, 0            
    je eel           

    cmp al, 'w'               
    je moveUp
    cmp al, 's'                
    je moveDown
    cmp al, 'a'                
    je moveLeft
    cmp al, 'd'               
    je moveRight
    cmp al, 32
    je pause1
    cmp al, 27               
    je endGame

eel:
    cmp movetype, 1
    je moveUp
    cmp movetype, 2
    je moveDown
    cmp movetype, 3
    je moveLeft
    cmp movetype, 4
    je moveRight
    jmp playerMovement      

moveUp:
    mov movetype, 1
    dec playerX              ; Decrease Y coordinate (move up1)
    call check_movement
    mov moveprev, 1
    mov right1, 1
    mov up2, 1
    jmp playerMovement

moveDown:
    mov movetype, 2
    inc playerX             ; Increase Y coordinate (move down1)
    call check_movement
    mov moveprev, 2
    mov left1, 1
    mov down2, 1
    jmp playerMovement

moveLeft:
    mov movetype, 3
    dec playerY                 ; Decrease X coordinate (move left1)
    call check_movement
    mov moveprev, 3
    mov down1, 1
    mov left2, 1
    jmp playerMovement

moveRight:
    mov movetype, 4
    inc playerY                ; Increase X coordinate (move right1)
    call check_movement
    mov moveprev, 4
    mov up1, 1
    mov right2, 1
    jmp playerMovement

pause1:
    call readchar
    jmp playerMovement

endGame:
    call filehandle
    ret                         ; Exit the game

playerMovement ENDP

setghostvalues Proc
    xor eax, eax
    cmp gh1, 4
    je gh4
    cmp gh1, 6
    je gh6
    cmp gh1, 9
    je gh9
    cmp gh1, 3
    je gh3

gh4:
    mov al, ghostinitial4X
    mov ghost4X, al
    mov ghost4XPrev, al
    mov X4previous, al
    mov al, ghostinitial4Y
    mov ghost4Y, al
    mov ghost4YPrev, al
    mov Y4previous, al
    ret
gh6: 
    mov al, ghostinitial6X
    mov ghost6X, al
    mov ghost6XPrev, al
    mov X6previous, al
    mov al, ghostinitial6Y
    mov ghost6Y, al
    mov ghost6YPrev, al
    mov Y6previous, al
    ret
gh9:
    mov al, ghostinitial9X
    mov ghost9X, al
    mov ghost9XPrev, al
    mov X9previous, al
    mov al, ghostinitial9Y
    mov ghost9Y, al
    mov ghost9YPrev, al
    mov Y9previous, al
    ret
gh3:
    mov al, ghostinitial3X
    mov ghost3X, al
    mov ghost3XPrev, al
    mov X3previous, al
    mov al, ghostinitial3Y
    mov ghost3Y, al
    mov ghost3YPrev, al
    mov Y3previous, al
    ret
setghostvalues endp

selectcolor Proc
    cmp gh1, 4
    je gh4
    cmp gh1, 6
    je gh6
    cmp gh1, 9
    je gh9
    cmp gh1, 3
    je gh3

gh4:
    mov eax, red+red*16
    call SetTextColor
    ret
gh6: 
    mov eax, Yellow+Yellow*16
    call SetTextColor
    ret
gh9:
    mov eax, Brown+Brown*16
    call SetTextColor
    ret
gh3:
    mov eax, Magenta+Magenta*16
    call SetTextColor
    ret
selectcolor endp

setghostvaluess Proc
    xor eax, eax
    cmp gh1, 4
    je gh4
    cmp gh1, 6
    je gh6
    cmp gh1, 9
    je gh9
    cmp gh1, 3
    je gh3

gh4:
    mov al, ghost4XPrev
    mov X4previous, al
    mov al, ghost4YPrev
    mov Y4previous, al
    mov al, ghost4X
    mov ghost4XPrev, al
    mov al, ghost4Y
    mov ghost4YPrev, al
    ret
gh6: 
    mov al, ghost6XPrev
    mov X6previous, al
    mov al, ghost6YPrev
    mov Y6previous, al
    mov al, ghost6X
    mov ghost6XPrev, al
    mov al, ghost6Y
    mov ghost6YPrev, al
    ret
gh9:
    mov al, ghost9XPrev
    mov X9previous, al
    mov al, ghost9YPrev
    mov Y9previous, al
    mov al, ghost9X
    mov ghost9XPrev, al
    mov al, ghost9Y
    mov ghost9YPrev, al
    ret
gh3:
    mov al, ghost3XPrev
    mov X3previous, al
    mov al, ghost3YPrev
    mov Y3previous, al
    mov al, ghost3X
    mov ghost3XPrev, al
    mov al, ghost3Y
    mov ghost3YPrev, al
    ret

    ret
setghostvaluess endp

GhostEatCheck PROC ghostX: BYTE, ghostY: BYTE, ghostInitialX: BYTE, ghostInitialY: BYTE, ghostPrevX: BYTE, ghostPrevY: BYTE, Xprevious: BYTE, Yprevious: BYTE
    
    ; Check if the ghost is scared
    cmp scaredGhostActive, 1
    je EatGhost              
    jmp GhostCollision     

EatGhost:     
    ; Save ghost's current position as previous position
    xor eax, eax
    mov al, ghostInitialX
    mov Xprevious, al
    xor eax, eax
    mov al, ghostInitialY
    mov Yprevious, al
    xor eax, eax

    mov dl, ghostPrevY
    mov dh, ghostPrevX
    call gotoxy
    mov eax, black+black*16
    call SetTextColor
    mov al, replace
    call writeChar

    ; Reset ghost to its initial position
    mov al, ghostInitialX 
    mov ghostX, al
    mov ghostPrevX, al
    mov al, ghostInitialY 
    mov ghostPrevY, al
    mov ghostY, al
    
    mov dl, playerYPrev
    mov dh, playerXPrev
    call gotoxy
    mov eax, black+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writeChar
    

    mov dl, playerY
    mov dh, playerX
    call gotoxy              
    mov eax, white+white*16     
    call SetTextColor
    xor eax, eax
    mov al, player           
    call writeChar

    ; Draw the ghost at its initial position
    mov dl, ghostY
    mov dh, ghostX
    call gotoxy              
    call selectcolor
    xor eax, eax
    mov al, ghost           
    call writeChar

    call setghostvalues

    ; Increment the score for eating the ghost
    add Score, 200           
    mov dl, 81               
    mov dh, 7
    call gotoxy
    mov eax, white+0
    call SetTextColor
    mov eax, Score         
    call writedec

    ret

GhostCollision:
    ; Decrement player lives
    sub playerlives, 1
    mov dl, 81
    mov dh, 8
    call gotoxy
    mov eax, white+0
    call SetTextColor
    mov eax, playerlives
    call writedec
    xor eax, eax

    ; Update player position to initial coordinates
    mov dl, ghostPrevY
    mov dh, ghostPrevX
    call gotoxy              
    mov eax, black+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writeChar

    mov dl, Yprevious
    mov dh, Xprevious
    call gotoxy             
    mov eax, black+black*16
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writeChar

    mov dl, playerinitialY
    mov dh, playerinitialX
    call gotoxy             
    mov eax, white+white*16
    call SetTextColor
    xor eax, eax
    mov al, player
    call writeChar
    
    mov al, ghostPrevY
    mov Yprevious, al
    mov al, ghostPrevX
    mov Xprevious, al

    mov dl, ghostY
    mov dh, ghostX
    call gotoxy               ; Move cursor to player initial position
    call selectcolor
    mov al, ghost           ; Erase player character
    call writeChar
    
    call setghostvaluess
    mov al, ghostY
    mov ghostPrevY, al
    mov al, ghostX
    mov ghostPrevX, al

    ; Update player's position variables
    mov al, playerinitialY
    mov playerY, al
    mov al, playerinitialX
    mov playerX, al
    mov playerXPrev, al
    mov al, playerY
    mov playerYPrev, al

    ret
GhostEatCheck ENDP

check_movement PROC

    xor eax, eax
    movzx ebx, playerY
    movzx eax, playerX
    imul eax, y1
    add eax, ebx
    mov index, eax

   mov cl, playerY
   cmp cl, ghost4Y
   je fcolide
   cmp cl, ghost3Y
   je tcolide
   cmp cl, ghost6Y
   je scolide
   cmp cl, ghost9Y
   je ncolide

endllll:
    call callforplayerMovement
    mov cl, byte ptr [esi + eax]

    cmp cl, 2
    je invalidMove

    cmp cl, 1
    je moveToSnack

    cmp cl, 8
    je highjumpL

    cmp cl, 7
    je highjumpR

    cmp cl, 0
    je finalizeMove      

    cmp cl, 5
    je moveToSpecial

   jmp endl

fcolide:
       mov cl, playerX
       cmp cl, ghost4X
       jne endllll
       mov gh1, 4
       INVOKE GhostEatCheck, ghost4X, ghost4Y, ghostinitial4X, ghostinitial4Y, ghost4XPrev, ghost4YPrev, x4previous, y4previous
       jmp endl

tcolide:
        mov cl, playerX
       cmp cl, ghost3X
       jne endllll
       mov gh1, 3
        INVOKE GhostEatCheck, ghost3X, ghost3Y, ghostinitial3X, ghostinitial3Y, ghost3XPrev, ghost3YPrev, x3previous, y3previous
        jmp endl

scolide:
        mov cl, playerX
       cmp cl, ghost6X
       jne endllll
       mov gh1, 6
        INVOKE GhostEatCheck, ghost6X, ghost6Y, ghostinitial6X, ghostinitial6Y, ghost6XPrev, ghost6YPrev, x6previous, y6previous
        jmp endl

ncolide:
        mov cl, playerX
       cmp cl, ghost9X
       jne endllll
       mov gh1, 9
        INVOKE GhostEatCheck, ghost9X, ghost9Y, ghostinitial9X, ghostinitial9Y, ghost9XPrev, ghost9YPrev, x9previous, y9previous
        jmp endl

highjumpR:
    movzx ebx, transr
    movzx eax, playerX
    imul eax, y1
    add eax, ebx
    mov index, eax
    mov edx, offset snackcheckgrid
    mov byte ptr [edx + eax], 0
    xor eax, eax
    xor ebx, ebx
    xor edx, edx    

    mov dl, 1
    mov dh, playerX
    call gotoxy
    mov eax, 0+black*16   ;-++++
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writeChar

    mov al, transl
    mov playerY, al
    mov dl, playerY
    mov dh, playerX
    call gotoxy
    mov eax, white+white*16   ;---++++
    call SetTextColor
    xor eax, eax
    mov al, player     
    call writeChar
    dec snackscounter
    jmp endl

highjumpL:
    movzx ebx, transl
    movzx eax, playerX
    imul eax, y1
    add eax, ebx
    mov index, eax
    mov edx, offset snackcheckgrid
    mov byte ptr [edx + eax], 0
    xor eax, eax
    xor edx, edx

    mov dl, transl
    mov dh, playerX
    call gotoxy
    mov eax, 0+black*16   ;-++++
    call SetTextColor
    xor eax, eax
    mov al, replace
    call writeChar
    

    mov playerY, 1
    mov dl, playerY
    mov dh, playerX
    call gotoxy
    mov eax, white+white*16   ;---++++
    call SetTextColor
    xor eax, eax
    mov al, player     
    call writeChar
    dec snackscounter
    jmp endl

moveToSnack:
    INVOKE PlaySound, OFFSET snackeatsound , NULL, SND_ASYNC
    movzx ebx, playerY
    movzx eax, playerX
    imul eax, y1
    add eax, ebx
    mov index, eax
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    cmp bl, 0
    je finalizeMove
    xor eax, eax
    xor ebx, ebx

    add Score, 10
    dec snackscounter
    mov dl, 81
    mov dh, 7
    call gotoxy
    mov eax, white+black*16
    call SetTextColor
    xor eax, eax
    mov eax, Score
    call writedec
    jmp finalizeMove

moveToSpecial:
    INVOKE PlaySound, OFFSET snackeatsound , NULL, SND_ASYNC
    movzx ebx, playerY
    movzx eax, playerX
    imul eax, y1
    add eax, ebx
    mov index, eax
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov bl, byte ptr [edx + eax]
    
    call checkscaredghost
    cmp bl, 0
    je finalizeMove
    xor eax, eax
    xor ebx, ebx
    
    add Score, 50
    dec snackscounter
    mov dl, 81
    mov dh, 7
    call gotoxy
    mov eax, white+black*16
    call SetTextColor
    xor eax, eax
    mov eax, Score
    call writedec
    jmp finalizeMove

finalizeMove:
    xor eax, eax
    xor edx, edx
    mov edx, offset snackcheckgrid
    mov eax, [index]
    mov byte ptr [edx + eax], 0
    xor ebx,ebx
    mov bl, byte ptr [edx + eax]
    xor eax, eax
    mov al, bl
    call writedec
    xor ebx, ebx
    xor edx, edx
    xor eax, eax

    mov dl, playerYPrev
    mov dh, playerXPrev
    call gotoxy
    mov al, replace
    call writeChar   ;--+++
    mov eax, 0+black*16   ;-++++
    call SetTextColor
    xor eax, eax

    xor ecx, ecx
    mov cl, playerY
    mov playerYPrev, cl
    xor ecx, ecx
    mov cl, playerX
    mov playerXPrev, cl
    xor ecx, ecx

    mov dl, playerY
    mov dh, playerX
    call gotoxy
    mov eax, white+white*16   ;---++++
    call SetTextColor
    xor eax, eax
    mov al, player     
    call writeChar
    ret

invalidMove:
    xor ecx, ecx
    mov cl, playerYPrev
    mov playerY, cl
    xor ecx, ecx
    mov cl, playerXPrev
    mov playerX, cl
    xor ecx, ecx
    mov cl, moveprev
    mov movetype, cl
    xor ecx, ecx

    ret

endl:

    ret
check_movement ENDP

checkscaredghost PROC
    cmp bl, 0
    jne k
    ret
k:
    mov scaredGhostActive, 1
    ret
checkscaredghost endp

; saving data in the file 
filehandle Proc      
    mov edx, OFFSET file
    call createoutputfile
    mov handler, eax

    mov eax, handler   ; writing the input
    mov edx, OFFSET array
    mov ecx, size1          
    call writetofile

    mov eax, handler     ; writing space
    mov edx, OFFSET spaces
    mov ecx, 1
    call writetofile

    call asciicheckscore   ; writing the score

    mov eax, handler     ; writing space
    mov edx, OFFSET spaces
    mov ecx, 1
    call writetofile

    cmp gamelevel, 1
    je printlone

    cmp gamelevel, 2
    je printltwo

    cmp gamelevel, 3
    je printlthree

    printlone:
        mov eax, handler     ; writing 1
        mov edx, offset fortyeight
        mov ecx, 1
        call writetofile
    jmp endll

     printltwo:
        mov eax, handler     ; writing 2
        mov edx, offset fortynine
        mov ecx, 2
        call writetofile
    jmp endll

     printlthree:
        mov eax, handler     ; writing 3
        mov edx, offset fifty
        mov ecx, 3
        call writetofile
    jmp endll

endll:
    mov eax, handler      ; writing the new line
    mov edx, OFFSET newline
    mov ecx, 2       
    call writetofile

    mov eax, handler
    call closefile
    ret
filehandle endp

asciiCheckScore PROC
    xor eax, eax
     mov eax, score  ; Load the score into eax
    xor edx, edx    ; Clear edx for division
loopl:
    cmp eax, 0      ; Compare eax with 0
    je endproc    


    mov ecx, 10
    xor edx, edx
    div ecx 
    mov score1, eax
    inc counter
    push edx
    mov eax, score1
    
    jmp loopl       ; Continue the loop

endproc:
    cmp counter, 0  
    je endl

loopll:
    pop edx                   
    add edx, 48               
    mov score1, edx           

    xor eax, eax

    mov eax, handler          
    mov edx, OFFSET score1          
    mov ecx, 1                
    call writetofile          
    dec counter
    cmp counter, 0  
    je endl
    jmp loopll        
endl:
    ret
asciiCheckScore ENDP

; this procedure for the delay
MyDelay PROC
    mov ecx, 800000
L1:
    loop L1
    ret
MyDelay ENDP


MyDelay1 PROC
    mov ecx, 500000
L1:
    loop L1
    ret
MyDelay1 ENDP


END main
